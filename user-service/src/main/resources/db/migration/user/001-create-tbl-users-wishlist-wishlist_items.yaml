  databaseChangeLog:
    - changeSet:
        id: 1 # add "users" table
        author: admin
        changes:
          - createTable:
              tableName: users
              columns:
                - column:
                    name: user_id
                    type: BIGINT
                    autoIncrement: true
                    constraints:
                      primaryKey: true
                - column:
                    name: username
                    type: VARCHAR(50)
                    constraints:
                      unique: true
                      nullable: false
                - column:
                    name: email
                    type: VARCHAR(100)
                    constraints:
                      unique: true
                      nullable: false
                - column:
                    name: password_hash
                    type: VARCHAR(255)
                    constraints:
                      nullable: false
                - column:
                    name: first_name
                    type: VARCHAR(50)
                - column:
                    name: last_name
                    type: VARCHAR(50)
                - column:
                    name: phone
                    type: VARCHAR(20)
                - column:
                    name: address_line1
                    type: VARCHAR(100)
                - column:
                    name: address_line2
                    type: VARCHAR(100)
                - column:
                    name: city
                    type: VARCHAR(50)
                - column:
                    name: state
                    type: VARCHAR(50)
                - column:
                    name: postal_code
                    type: VARCHAR(20)
                - column:
                    name: country
                    type: VARCHAR(50)
                - column:
                    name: role
                    type: VARCHAR(50)
                    defaultValue: customer
                    constraints:
                      nullable: false
                      checkConstraint: role IN ('customer', 'admin')
                - column:
                    name: created_at
                    type: TIMESTAMP
                    defaultValueComputed: CURRENT_TIMESTAMP
                - column:
                    name: updated_at
                    type: TIMESTAMP
                    defaultValueComputed: CURRENT_TIMESTAMP
                - column:
                    name: is_active
                    type: BOOLEAN
                    defaultValueBoolean: true
                - column:
                    name: is_deleted
                    type: BOOLEAN
                    defaultValueBoolean: false
                    constraints:
                      nullable: false
                - column:
                    name: password_changed_at
                    type: TIMESTAMP
                - column:
                    name: provider
                    type: VARCHAR(50)
                - column:
                    name: provider_id
                    type: VARCHAR(255)
          - createIndex:
              tableName: users
              indexName: idx_users_email
              columns:
                - column:
                    name: email
          - createIndex:
              tableName: users
              indexName: idx_users_username
              columns:
                - column:
                    name: username
    - changeSet:
        id: 2 # add "wishlists" table
        author: admin
        changes:
          - createTable:
              tableName: wishlists
              columns:
                - column:
                    name: wishlist_id
                    type: BIGINT
                    autoIncrement: true
                    constraints:
                      primaryKey: true
                - column:
                    name: user_id
                    type: BIGINT
                    constraints:
                      nullable: false
                - column:
                    name: created_at
                    type: TIMESTAMP
                    defaultValueComputed: CURRENT_TIMESTAMP
                - column:
                    name: updated_at
                    type: TIMESTAMP
                    defaultValueComputed: CURRENT_TIMESTAMP
          - createIndex:
              tableName: wishlists
              indexName: idx_wishlists_user_id
              columns:
                - column:
                    name: user_id
    - changeSet:
        id: 3 # add "wishlist_items" table
        author: admin
        changes:
          - createTable:
              tableName: wishlist_items
              columns:
                - column:
                    name: wishlist_item_id
                    type: BIGINT
                    autoIncrement: true
                    constraints:
                      primaryKey: true
                - column:
                    name: wishlist_id
                    type: BIGINT
                    constraints:
                      nullable: false
                - column:
                    name: product_variant_id
                    type: BIGINT
                    constraints:
                      nullable: false
                      # No FK to Products (in product_db)
                - addUniqueConstraint:
                    tableName: wishlist_items
                    columnNames: wishlist_id, product_variant_id
          - createIndex:
              tableName: wishlist_items
              indexName: idx_wishlist_items_wishlist_id
              columns:
                - column:
                    name: wishlist_id
          - createIndex:
              tableName: wishlist_items
              indexName: idx_wishlist_items_product_variant_id
              columns:
                - column:
                    name: product_variant_id
    - include:
        file: db/migration/user/002-update-tbl-wishlist-wishlist_items.yaml
