
  databaseChangeLog:
    - changeSet:
        id: 1 # add "cart" table
        author: admin
        changes:
          - createTable:
              tableName: cart
              columns:
                - column:
                    name: cart_id
                    type: BIGINT
                    autoIncrement: true
                    constraints:
                      primaryKey: true
                - column:
                    name: user_id
                    type: BIGINT
                    constraints:
                      nullable: false
                - column:
                    name: created_at
                    type: TIMESTAMP
                    defaultValueComputed: CURRENT_TIMESTAMP
                - column:
                    name: updated_at
                    type: TIMESTAMP
                    defaultValueComputed: CURRENT_TIMESTAMP
          - createIndex:
              tableName: cart
              indexName: idx_carts_user_id
              columns:
                - column:
                    name: user_id

    - changeSet:
        id: 2 # add "cart_item" table
        author: admin
        changes:
          - createTable:
              tableName: cart_item
              columns:
                - column:
                    name: cart_item_id
                    type: BIGINT
                    autoIncrement: true
                    constraints:
                      primaryKey: true
                - column:
                    name: cart_id
                    type: BIGINT
                    constraints:
                      nullable: false
                - column:
                    name: product_variant_id
                    type: BIGINT
                    constraints:
                      nullable: false
                - column:
                    name: quantity
                    type: INT
                    constraints:
                      nullable: false
                      defaultValue: 1
          - addUniqueConstraint:
              tableName: cart_item
              columnNames: cart_id, product_variant_id
          - createIndex:
              tableName: cart_item
              indexName: idx_cart_items_cart_id
              columns:
                - column:
                    name: cart_id
          - createIndex:
              tableName: cart_item
              indexName: idx_cart_items_product_variant_id
              columns:
                - column:
                    name: product_variant_id
    - include:
        file: db/migration/cart_changelog_add_fks.yaml

