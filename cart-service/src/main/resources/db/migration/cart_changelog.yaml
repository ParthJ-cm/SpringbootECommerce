
  databaseChangeLog:
    - changeSet:
        id: 1
        author: admin
        changes:
          - createTable:
              tableName: Carts
              columns:
                - column:
                    name: cart_id
                    type: BIGINT
                    autoIncrement: true
                    constraints:
                      primaryKey: true
                - column:
                    name: user_id
                    type: BIGINT
                    constraints:
                      nullable: false
                      # No FK to Users (in user_db)
                - column:
                    name: created_at
                    type: TIMESTAMP
                    defaultValueComputed: CURRENT_TIMESTAMP
                - column:
                    name: updated_at
                    type: TIMESTAMP
                    defaultValueComputed: CURRENT_TIMESTAMP
          - createIndex:
              tableName: Carts
              indexName: idx_carts_user_id
              columns:
                - column:
                    name: user_id

    - changeSet:
        id: 2
        author: admin
        changes:
          - createTable:
              tableName: Cart_Items
              columns:
                - column:
                    name: cart_item_id
                    type: BIGINT
                    autoIncrement: true
                    constraints:
                      primaryKey: true
                - column:
                    name: cart_id
                    type: BIGINT
                    constraints:
                      nullable: false
                - column:
                    name: product_id
                    type: BIGINT
                    constraints:
                      nullable: false
                      # No FK to Products (in product_db)
                - column:
                    name: quantity
                    type: INT
                    constraints:
                      nullable: false
                      defaultValue: 1
                - column:
                    name: created_by
                    type: BIGINT
                - column:
                    name: updated_by
                    type: BIGINT
          - addUniqueConstraint:
              tableName: Cart_Items
              columnNames: cart_id, product_id
          - createIndex:
              tableName: Cart_Items
              indexName: idx_cart_items_cart_id
              columns:
                - column:
                    name: cart_id
          - createIndex:
              tableName: Cart_Items
              indexName: idx_cart_items_product_id
              columns:
                - column:
                    name: product_id
    - include:
        file: db/migration/cart_changelog_add_fks.yaml
